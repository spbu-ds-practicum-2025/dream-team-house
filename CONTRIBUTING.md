# Руководство по участию в проекте

## Структура проекта

Проект организован по микросервисной архитектуре. Все сервисы находятся в папке `services/`.

## Рабочий процесс

### 1. Создание новой ветки

Всегда создавайте новую ветку от `main` для работы над задачей:

```bash
git checkout main
git pull origin main
git checkout -b feature/my-feature-name
```

Именование веток:
- `feature/` - новая функциональность
- `fix/` - исправление ошибок
- `refactor/` - рефакторинг кода
- `docs/` - обновление документации

### 2. Разработка

#### Работа с сервисами

Каждый сервис имеет свою структуру:

```
services/<service-name>/
├── README.md           # Описание сервиса
├── Dockerfile          # Конфигурация контейнера
├── .gitignore         # Игнорируемые файлы
└── src/ или app/      # Исходный код
```

#### Локальный запуск

```bash
# Запустить всю систему
make up

# Запустить с AI агентами
make start-agents

# Просмотреть логи
make logs

# Остановить систему
make down
```

#### Перед коммитом

1. Проверьте, что ваш код работает локально
2. Убедитесь, что не нарушили существующую функциональность
3. Обновите документацию, если добавили новые API или изменили поведение

### 3. Коммиты

Используйте понятные сообщения коммитов на русском или английском:

```bash
git add .
git commit -m "Добавлен endpoint для получения версий документа"
```

Хорошие примеры:
- ✅ "Реализован механизм репликации между узлами"
- ✅ "Исправлена ошибка обработки конфликтов"
- ✅ "Обновлена документация API Analytics Service"

Плохие примеры:
- ❌ "fix"
- ❌ "update"
- ❌ "работает"

### 4. Pull Request

Перед созданием PR:

1. Убедитесь, что ваша ветка актуальна:
   ```bash
   git checkout main
   git pull origin main
   git checkout your-branch
   git rebase main
   ```

2. Запушьте изменения:
   ```bash
   git push origin your-branch
   ```

3. Создайте PR на GitHub, используя шаблон

#### Требования к PR

- **Понятное описание**: что сделано и зачем
- **Обновлённая документация**: если изменили API или архитектуру
- **Работает локально**: можно запустить через Docker Compose
- **Минимальные изменения**: не меняйте код, не связанный с вашей задачей

### 5. Code Review

После создания PR:

1. Дождитесь ревью от коллег
2. Исправьте замечания, если они есть
3. После одобрения ваш PR будет смержен в `main`

## Что можно и нельзя менять

### ✅ Можно изменять:

- Любой код в `services/`
- `README.md` в корне проекта
- `docker-compose.yml`
- Конфигурационные файлы сервисов

### ❌ Нельзя изменять:

- `/docs/` (только кураторы)
- `CODEOWNERS` (только кураторы)
- `.github/` (только кураторы)

## Работа с Docker

### Основные команды

```bash
# Сборка образов
make build

# Запуск системы
make up

# Остановка
make down

# Полная очистка (включая БД)
make clean

# Просмотр логов
make logs

# Статус сервисов
make status
```

### Масштабирование агентов

```bash
# Запустить 10 агентов
docker-compose up -d --scale ai-agent=10

# Остановить агентов
make stop-agents
```

## Отладка

### Просмотр логов конкретного сервиса

```bash
docker-compose logs -f text-service-a
docker-compose logs -f chat-service
```

### Подключение к контейнеру

```bash
docker-compose exec text-service-a bash
docker-compose exec redis redis-cli
```

### Проверка БД

```bash
# PostgreSQL
docker-compose exec postgres-text-a psql -U textservice -d textservice

# Redis
docker-compose exec redis redis-cli
```

## Стиль кода

### Python

- Следуйте PEP 8
- Используйте type hints
- Документируйте функции docstrings

### JavaScript

- Используйте ES2024+ синтаксис
- Предпочитайте `const` и `let` вместо `var`
- Используйте async/await для асинхронного кода

### C++

- Следуйте C++17 стандарту
- Используйте умные указатели (smart pointers)
- Документируйте классы и функции

## Тестирование

### Python сервисы

```bash
cd services/text-service
pytest tests/
```

### JavaScript сервисы

```bash
cd services/ai-agent
npm test
```

## Вопросы?

Если у вас возникли вопросы:

1. Прочитайте [техническое решение](docs/tr.md)
2. Посмотрите README соответствующего сервиса
3. Спросите в чате команды
4. Создайте issue на GitHub

## Полезные ссылки

- [Техническое решение](docs/tr.md)
- [Структура API](docs/tr.md#api-endpoints)
- [Архитектурная диаграмма](docs/tr.md#архитектурная-диаграмма)
